# 디지털화환 프로젝트 - 초기 구현 계획

> 이 문서는 클라이언트 요구사항과 초기 기술 설계를 담고 있습니다.
> 실제 구현 완료 내역은 [완료기록.md](./완료기록.md)를 참고하세요.

## 회의 요약 (핵심 포인트)

### 클라이언트가 원하는 것
1. **두 가지 방식 모두 필요**: 템플릿 방식(기본) + AI 생성 방식(프리미엄)
2. **현재 UX가 너무 복잡함**: 단순하게 바꿔야 함
3. **영상 품질 향상**: 단순한 회전이 아닌 화려한 모션 그래픽 필요
4. **정사각형(1:1) 비율 필수**: 홀로그램 팬이 원형이라서
5. **검은 배경 필수**: 홀로그램에서 검은색은 투명하게 보임
6. **1월 내 완료**: 2월 전까지 결과물 제출 필요

---

## 1. 구현해야 할 기능 (우선순위순)

### 🥇 기능 A: AI 영상 합성 (최우선순위)
**설명**: AI가 6개의 장면을 만들어서 30초 영상으로 합성

**작동 방식**:
1. 고객이 6개 문구 입력 (또는 키워드 선택하면 AI가 자동 생성)
   - 1번: 제목 (예: "김철수 ♥ 이영희 결혼식")
   - 2~5번: 축하 문구들
   - 6번: 보내는 사람/로고
2. 각 문구마다 AI가 이미지 생성 (6개)
3. 각 이미지를 5초 영상으로 변환 (6개)
4. 6개 영상을 하나로 합쳐서 30초 영상 완성

### 🥈 기능 B: 템플릿 영상 생성 (2순위)
**설명**: 미리 만들어진 예쁜 영상 템플릿 위에 고객이 입력한 텍스트만 합성

**작동 방식**:
1. 엠바토에서 예쁜 영상 템플릿 구매
2. 고객이 "신랑: 홍길동, 신부: 김영희" 같은 정보 입력
3. 영상 위에 화려한 글자 애니메이션으로 텍스트 표시
4. 완성된 영상 다운로드

### 🥉 기능 C: UX 단순화 (3순위)
**현재 문제**: 복잡한 프롬프트 입력, 스타일 12개 선택 등 → 고객이 뭘 써야 할지 모름

**해결책**:
- 행사 유형: 3개만 (결혼식, 개업, 행사)
- 키워드 선택: 미리 준비된 키워드 중 고르기 (예: "사랑", "행복", "축복" 등)
- AI가 키워드로 자동 프롬프트 생성

---

## 2. 기술적 구현 방안

### 템플릿 방식: Remotion 사용 (추천)

**Remotion이란?**
- React로 영상을 만드는 라이브러리
- 우리 프로젝트가 이미 React(Next.js) 기반이라 잘 맞음
- 글자 애니메이션을 자유롭게 만들 수 있음
- 무료 (서버 비용만 발생)

**다른 옵션과 비교**:
| 옵션 | 장점 | 단점 |
|------|------|------|
| **Remotion** | React 호환, 무료, 자유로운 애니메이션 | 직접 구현 필요 |
| Creatomate | 쉬움 | 유료 (분당 $0.14~$0.28) |
| FFmpeg | 무료 | 복잡한 애니메이션 어려움 |

### AI 방식: 현재 코드 확장

**이미 있는 것**:
- 이미지 생성 API (Gemini 3)
- 영상 생성 API (Veo 3.1)

**추가해야 할 것**:
- 6개 영상 합치는 API (FFmpeg 사용)
- 키워드 → 프롬프트 자동 생성 기능

---

## 3. 수정할 파일 목록

### 새로 만들 파일

```
src/
├── data/
│   └── keywords.ts                 # 키워드 데이터 (결혼식/개업/행사별 50개씩)
│
├── remotion/                       # 템플릿 영상 생성용 (새 폴더)
│   ├── compositions/
│   │   ├── WeddingTemplate.tsx     # 결혼식 템플릿
│   │   ├── OpeningTemplate.tsx     # 개업 템플릿
│   │   └── EventTemplate.tsx       # 행사 템플릿
│   ├── components/
│   │   ├── AnimatedText.tsx        # 화려한 글자 애니메이션
│   │   └── HologramBorder.tsx      # 홀로그램 테두리 효과
│   └── Root.tsx
│
├── app/api/
│   ├── ai/
│   │   ├── merge-videos/route.ts   # 영상 6개 합치는 API (새로 만듦)
│   │   └── generate-prompt/route.ts # 키워드로 프롬프트 만드는 API (새로 만듦)
│   └── template/
│       └── render/route.ts         # 템플릿 렌더링 API (새로 만듦)
│
└── components/hologram-wizard/     # 통합 위자드 (기존 개선)
    ├── steps/
    │   ├── EventTypeStep.tsx       # 1단계: 행사 유형 (3개만)
    │   ├── KeywordStep.tsx         # 2단계: 키워드 선택
    │   ├── InfoInputStep.tsx       # 3단계: 기본 정보 (이름, 날짜 등)
    │   ├── ModeSelectStep.tsx      # 4단계: 템플릿 vs AI 선택
    │   └── GenerationStep.tsx      # 5단계: 생성 진행
    └── hooks/
        └── useHologramWizard.ts    # 상태 관리
```

### 수정할 파일

| 파일 | 수정 내용 |
|------|----------|
| `src/components/ai-hologram/HologramWizard.tsx` | UX 단순화, 새로운 스텝 구조 |
| `src/components/ai-hologram/steps/PromptStep.tsx` | 키워드 선택 방식으로 변경 |
| `src/app/api/ai/generate-video/route.ts` | 1:1 비율 출력 추가 |
| `src/services/aiService.ts` | 영상 합성, 프롬프트 생성 함수 추가 |
| `src/data/templates.ts` | 템플릿 메타데이터 추가 |

---

## 4. 구현 일정 (1월 내 완료)

### 1월 2주차 (1/6 ~ 1/12): 🥇 AI 영상 합성 - 핵심 기능
- [ ] 6개 문구 입력 UI 개발
- [ ] 6개 이미지 병렬 생성 로직
- [ ] 6개 영상 병렬 생성 로직
- [ ] 영상 합성 API (FFmpeg)
- [ ] 1:1 비율 크롭 처리
- [ ] 테스트 및 디버깅

### 1월 3주차 (1/13 ~ 1/19): 🥈 템플릿 영상 생성
- [ ] Remotion 프로젝트 설정
- [ ] 기본 템플릿 3개 (결혼/개업/행사)
- [ ] 텍스트 모션 그래픽 컴포넌트
- [ ] 템플릿 렌더링 API
- [ ] 엠바토 템플릿 연동

### 1월 4주차 (1/20 ~ 1/26): UX 단순화 + 통합
- [ ] 키워드 데이터 파일 생성 (결혼식/개업/행사별)
- [ ] 키워드 선택 UI 컴포넌트
- [ ] 프롬프트 자동 생성 API
- [ ] 위자드 전체 플로우 통합
- [ ] 결제 연동 확인

### 1월 5주차 (1/27 ~ 1/31): 최종 테스트 + 마무리
- [ ] 홀로그램 디바이스 실제 테스트
- [ ] 버그 수정
- [ ] 성능 최적화
- [ ] 최종 점검 및 배포

---

## 5. 비용 예상

### AI 생성 방식 (6개 영상 합성)
- 이미지 생성 6개: $0.02 × 6 = **$0.12**
- 영상 생성 6개: $0.15 × 6 = **$0.90**
- **합계: 약 $1.02 (약 1,400원/건)**

### 템플릿 방식
- Remotion 렌더링: 약 $0.02/분
- **합계: 약 30원/건**

---

## 6. 주의사항

### 반드시 지켜야 할 것
1. **검은 배경 (#000000)**: 홀로그램에서 투명하게 보이려면 필수
2. **정사각형 (1:1) 비율**: 원형 홀로그램 팬에 맞춤
3. **텍스트는 원 안에**: 화면 가장자리 텍스트는 잘릴 수 있음

### 기술적 제약
- Vercel 함수 타임아웃: 최대 300초 (5분)
- 6개 영상 순차 생성 시 시간 초과 가능 → 병렬 처리 필요
- `/tmp` 폴더만 파일 저장 가능

---

## 7. 확인 필요 사항

- [ ] 엠바토 템플릿 구매 완료 여부
- [ ] 홀로그램 팬의 정확한 해상도 (예: 1080x1080?)
- [ ] 템플릿에 들어갈 기본 문구 목록 (결혼식/개업/행사별)

---

## 8. 대안 구현 방식 검토 (초기 아이디어)

### 컨셉: 단일 영상 + 텍스트 오버레이

**핵심 아이디어**: 6개 장면이 텍스트만 다르고 배경이 동일하다면, 배경 영상 1개만 AI로 생성하고 텍스트는 FFmpeg로 오버레이

**작동 방식**:
1. 고객이 키워드/스타일 선택
2. AI가 **텍스트 없는** 배경 이미지 1개 생성 (미리보기)
3. 고객이 이미지 확인 후 승인
4. AI가 이미지를 30초 배경 영상으로 변환 (1개)
5. 고객이 6개 텍스트 문구 입력
6. FFmpeg가 각 문구를 5초씩 애니메이션으로 오버레이
7. 최종 30초 영상 완성

### 비용 비교

| 항목 | 6영상 방식 | 1영상+텍스트 방식 |
|------|-----------|------------------|
| 이미지 생성 | 6개 × $0.02 = $0.12 | 1개 × $0.02 = $0.02 |
| 영상 생성 | 6개 × $0.15 = $0.90 | 1개 × $0.15 = $0.15 |
| **총 비용** | **$1.02 (1,400원)** | **$0.17 (230원)** |
| **절감률** | - | **약 83% 절감** |

### 장단점

**장점**:
1. 비용 대폭 절감: 건당 1,400원 → 230원
2. API 할당량 여유: 12회 → 2회로 6배 여유
3. 텍스트 수정 용이: 영상 재생성 없이 텍스트만 수정 가능
4. 단계별 확인 가능: 이미지 미리보기 → 승인 → 영상 생성 UX
5. 유명인 필터링 우회: 텍스트 없는 추상적 배경만 생성

**단점**:
1. 장면별 다른 배경 불가: 모든 장면이 동일한 배경 사용
2. FFmpeg 구현 필요: 텍스트 애니메이션 직접 구현

---

**최종 선택**: 1영상+텍스트 오버레이 방식으로 구현 결정 (비용 효율성)

---

**작성일**: 2026-01-06
**최종 수정**: 2026-01-10
