# 텍스트 위치 및 크기 문제 해결

**생성일**: 2026-01-12
**파일**: `src/remotion/HologramTextOverlay.tsx`, `src/app/api/ai/render-text-overlay/route.ts`
**완료일**: 2026-01-12

---

## 문제 상황

1. **텍스트 위치**: 상단/중앙/좌/우 선택 시 텍스트가 프레임 밖으로 나가거나 위치가 부정확
2. **텍스트 줄바꿈**: 짧은 멘트도 3줄로 표시됨 (`whiteSpace: 'pre-wrap'` 문제)
3. **크기 불일치**: 미리보기와 실제 렌더링의 fontSize 기본값이 달라서 크기 불일치

---

## 해결 방법

### 1. 텍스트 줄바꿈 차단 (Lines 143-157)

```typescript
const textStyle: React.CSSProperties = {
  fontSize: `${fontSize}px`,
  fontFamily,
  fontWeight: 900,
  color: color,
  textAlign: 'center',
  whiteSpace: 'nowrap',        // 한 줄로 표시 (줄바꿈 차단)
  width: 'max-content',        // 텍스트 길이만큼 너비 확장
  overflow: 'visible',         // 글로우 이펙트 유지
  // ...
};
```

**효과**: 모든 텍스트가 한 줄로 표시됨 (줄바꿈 없음)

### 2. 위치 좌표 조정 (Lines 79-122)

**11차 수정: vh 좌표 최종 조정 (2026-01-12) ✅**

translateY를 % 대신 vh(viewport height) 단위로 변경하여 폰트 크기에 영향받지 않도록 수정

| 위치 | topPos | translateY | 단위 | 설명 |
|-----|--------|-----------|------|------|
| **상단** | 75% | -95vh | 화면 기준 | 폰트 크기 무관 |
| **중앙** | 75% | -45vh | 화면 기준 | 폰트 크기 무관 |
| **하단** | 75% | -25vh | 화면 기준 | 폰트 크기 무관 |
| **좌측** | 75% (left: 25%) | -45vh | 화면 기준 | 중앙 높이, 좌측 |
| **우측** | 75% (left: 75%) | -45vh | 화면 기준 | 중앙 높이, 우측 |

**변경 이유**:
- 기존 % 단위는 요소 자체 높이 기준 → 폰트 크기가 커지면 위치가 올라가는 문제
- vh 단위는 화면(viewport) 높이 기준 → 폰트 크기에 영향받지 않음
- 예: -95vh = 화면 높이의 95% 위로 이동 (항상 일정)

**이전 시도들**:
- 4차: 모든 위치 translateY -100% 통일 → 실패 (모두 같은 높이)
- 5차: 표준 접근 (top/center: -50%, bottom: -100%) → 여전히 구분 안됨
- 6차: padding 감소 + top 극단적 조정 → 구분 안됨
- 7-9차: 다양한 % 좌표 시도 → 폰트 크기 변경 시 위치 이동 문제
- 10차: vh 단위 도입 (-60vh, -25vh, -5vh) → 폰트 크기 무관하게 위치 고정 성공
- 11차: vh 좌표 미세 조정 (-95vh, -45vh, -25vh) → **최종 완료 ✅**

### 3. fontSize 기본값 통일

**문제**: 미리보기(120)와 실제 렌더링(60)의 fontSize 기본값이 달라서 크기 불일치

**해결**:
- `render-text-overlay/route.ts` Line 48: `let fontSize = 120;`
- `render-text-overlay/route.ts` Line 72: `fontSize = parseInt(...) || 120;`
- `render-text-overlay/route.ts` Line 82: `fontSize = body.fontSize || 120;`

**결과**: 미리보기와 실제 렌더링 크기 완전 일치

### 4. 크기 일치 확인

모든 곳에서 1080x1080 사용:
- TextPreviewStep Player: `compositionWidth={1080}`, `compositionHeight={1080}`
- Root.tsx Composition: `width={1080}`, `height={1080}`
- render-text-overlay API: 동일한 composition 사용

---

## 테스트 체크리스트

- [x] 모든 텍스트가 한 줄로 표시
- [x] 짧은 멘트도 줄바꿈 없음
- [x] 미리보기와 실제 렌더링 크기 동일
- [x] 하단 위치 정확
- [x] 상단/중앙/좌/우 위치 프레임 안에 표시
- [x] 폰트 크기 변경 시에도 위치 고정

---

## 수정 이력

### 11차 수정 (2026-01-12) ✅ **최종**
**변경**: vh 좌표 미세 조정
**좌표**:
- 상단: -95vh
- 중앙: -45vh
- 하단: -25vh
**효과**: 모든 위치가 정확하게 표시, 폰트 크기에 무관
**상태**: ✅ 완료

### 10차 수정 (2026-01-12) ✅
**문제**: 폰트 크기를 키우면 텍스트 위치가 위로 올라감
**원인**: translateY % 단위는 요소 높이 기준 → 폰트 커지면 요소 높이 증가 → translateY 절대값 증가
**해결**: vh(viewport height) 단위로 변경
**좌표**:
- 상단: -60vh
- 중앙: -25vh
- 하단: -5vh
**효과**: 폰트 크기에 관계없이 위치 고정

### 9차 수정 (2026-01-12)
**변경**: 사용자 제공 좌표 적용
**좌표**:
- 상단: -550%
- 중앙: -250%
- 좌/우: -250%
- 하단: -175%
**문제**: 폰트 크기 변경 시 위치 이동

### 8차 수정 (2026-01-12)
**변경**: topPos 90% → 75%로 조정 (translateY 유지)
**목적**: 전체적으로 위로 이동하여 위치 정확도 향상

### 7차 수정 (2026-01-12)
**접근**: 하단을 기준점으로 모든 위치를 `top: 90%`로 통일, translateY만 조정
**설정**:
- 상단: `translateY: -200%` (하단 대비 2배 위로)
- 중앙: `translateY: -150%` (하단 대비 1.5배 위로)
- 하단: `translateY: -100%` (기준점, 유지)

### 6차 수정 (2026-01-12)
**문제**: 5차 수정 후에도 상/중/하 위치 구분 안됨
**원인 분석**: padding: 80px가 컨테이너 높이를 크게 증가시켜 percentage-based translateY 계산에 영향
**해결책**: padding 80px → 40px 감소, 상단 위치 극단적 조정
**결과**: 여전히 구분 안됨

### 5차 수정 (2026-01-12)
**시도**: 표준 CSS 접근 (top/center: -50%, bottom: -100%)
**결과**: 위치 구분 실패

### 4차 수정 (2026-01-12)
**시도**: 모든 위치에 translateY -100% 통일
**결과**: 모든 위치가 같은 높이에 표시 (실패)

---

**최종 수정**: 2026-01-12 (11차 - vh 좌표 최종 조정) ✅
**상태**: 완료
