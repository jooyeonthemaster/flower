# ë””ì§€í„¸í™”í™˜ í”„ë¡œì íŠ¸ - ì˜¤ë¥˜ í•´ê²° ê¸°ë¡ (í˜„ì¬ ì§„í–‰ ì¤‘)

> ì´ ë¬¸ì„œëŠ” **í˜„ì¬ ì§„í–‰ ì¤‘ì¸** ì˜¤ë¥˜ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.
> í•´ê²°ëœ ì˜¤ë¥˜ëŠ” ìë™ìœ¼ë¡œ [archive/ì˜¤ë¥˜í•´ê²°-2026-01-archived.md](./archive/ì˜¤ë¥˜í•´ê²°-2026-01-archived.md)ë¡œ ì´ë™ë©ë‹ˆë‹¤.

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-23

---

## ğŸ“‹ í˜„ì¬ ìƒíƒœ

**ğŸ‰ í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì˜¤ë¥˜ê°€ ì—†ìŠµë‹ˆë‹¤!**

ë§ˆì§€ë§‰ í•´ê²°ëœ ì˜¤ë¥˜:
- **ì˜¤ë¥˜ #20**: Vercel FFmpeg ë¯¸ì‘ë™ â†’ âœ… í•´ê²° ì™„ë£Œ (2026-01-23)
- **ì˜¤ë¥˜ #19**: 413 Payload Too Large â†’ âœ… í•´ê²° ì™„ë£Œ (2026-01-23)
- **ì˜¤ë¥˜ #18**: Firebase Storage CORS ì—ëŸ¬ â†’ âœ… í•´ê²° ì™„ë£Œ (2026-01-23)

---

## ìµœê·¼ í•´ê²°ëœ ì˜¤ë¥˜ (2026-01-23)

### ì˜¤ë¥˜ #20: Vercel FFmpeg ë¯¸ì‘ë™ âœ…

**ë°œìƒì¼**: 2026-01-23
**ì™„ë£Œì¼**: 2026-01-23
**íŒŒì¼**: `next.config.ts`, `vercel.json`
**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

#### ë¬¸ì œ ìƒí™©

- Vercel ë°°í¬ í›„ ì˜ìƒ í•©ì„±(merge) ì‹œ 3ê°œ ì˜ìƒì´ ì•„ë‹Œ 1ê°œë§Œ ë°˜í™˜
- ë¡œì»¬ì—ì„œëŠ” ì •ìƒ ì‘ë™

#### ì›ì¸

- Next.js ë¹Œë“œ ì‹œ ffmpeg-static ë°”ì´ë„ˆë¦¬ê°€ ë²ˆë“¤ì—ì„œ ì œì™¸ë¨
- FFmpegë¥¼ ì°¾ì§€ ëª»í•˜ë©´ ì²« ë²ˆì§¸ ì˜ìƒë§Œ ë°˜í™˜í•˜ëŠ” fallback ë¡œì§ ì‹¤í–‰

#### í•´ê²° ë°©ë²•

`next.config.ts`ì— `outputFileTracingIncludes` ì„¤ì • ì¶”ê°€:
```typescript
outputFileTracingIncludes: {
  '/api/ai/merge-videos': ['./node_modules/ffmpeg-static/ffmpeg'],
  '/api/ai/loop-video': ['./node_modules/ffmpeg-static/ffmpeg'],
},
serverExternalPackages: [..., 'ffmpeg-static'],
```

**ì°¸ê³ **: [Vercel Labs - FFmpeg on Vercel](https://github.com/vercel-labs/ffmpeg-on-vercel)

---

### ì˜¤ë¥˜ #19: 413 Payload Too Large âœ…

**ë°œìƒì¼**: 2026-01-23
**ì™„ë£Œì¼**: 2026-01-23
**íŒŒì¼**: `check-video-status/route.ts`, `merge-videos/route.ts`
**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

#### ë¬¸ì œ ìƒí™©

- AI ì˜ìƒ í•©ì„± ì‹œ 3ê°œ ì˜ìƒ í•©ì„± ë‹¨ê³„ì—ì„œ 413 ì—ëŸ¬ ë°œìƒ
- ê° ì˜ìƒì´ ~30MB, 3ê°œ = 90MB+ ìš”ì²­ í˜ì´ë¡œë“œ

#### ì›ì¸

- `check-video-status` APIê°€ ìƒì„±ëœ ì˜ìƒì„ Base64ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜
- Base64 ì¸ì½”ë”©ìœ¼ë¡œ ~33% í¬ê¸° ì¦ê°€ â†’ 90MB+ ìš”ì²­ ë°œìƒ

#### í•´ê²° ë°©ë²•

ì˜ìƒì„ Firebase Storageì— ì—…ë¡œë“œ í›„ URLë§Œ ë°˜í™˜:
```typescript
const bucket = getStorage().bucket();
await file.save(buffer, { metadata: { contentType: 'video/mp4' } });
await file.makePublic();
finalVideoUrl = `https://storage.googleapis.com/${bucket.name}/${uploadPath}`;
```

---

### ì˜¤ë¥˜ #18: Firebase Storage CORS ì—ëŸ¬ âœ…

**ë°œìƒì¼**: 2026-01-23
**ì™„ë£Œì¼**: 2026-01-23
**íŒŒì¼**: `cors.json`
**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

#### ë¬¸ì œ ìƒí™©

- ë¸Œë¼ìš°ì €ì—ì„œ Firebase Storage ì˜ìƒì— ì ‘ê·¼ ë¶ˆê°€
- `Access-Control-Allow-Origin` í—¤ë” ëˆ„ë½ ì—ëŸ¬

#### í•´ê²° ë°©ë²•

```json
[{
  "origin": ["https://www.flower-signage.com", "http://localhost:3000"],
  "method": ["GET", "HEAD", "OPTIONS"],
  "maxAgeSeconds": 3600,
  "responseHeader": ["Content-Type", "Content-Length", "Content-Range", "Accept-Ranges"]
}]
```

ì ìš©: `gsutil cors set cors.json gs://flower-63624.firebasestorage.app`

---

## ì´ì „ í•´ê²°ëœ ì˜¤ë¥˜ (2026-01-11)

### ì˜¤ë¥˜ #15: Remotion "Target Closed" ì—ëŸ¬ (ë©”ëª¨ë¦¬ í¬ë˜ì‹œ) âœ…

**ë°œìƒì¼**: 2026-01-11
**ì™„ë£Œì¼**: 2026-01-11
**íŒŒì¼**: `render-text-overlay/route.ts`, `temp-video/[id]/route.ts`
**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ (í…ŒìŠ¤íŠ¸ ì„±ê³µ)

#### ì˜¤ë¥˜ ë©”ì‹œì§€
```
Protocol error (Page.addScriptToEvaluateOnNewDocument): Target closed.
https://www.remotion.dev/docs/target-closed
```

**í„°ë¯¸ë„ ë¡œê·¸**:
```
Starting Remotion text overlay rendering with 6 texts
Using Base64 video data URL directly for Remotion
Bundling Remotion composition...
Bundle created: C:\Users\jayit\AppData\Local\Temp\remotion-webpack-bundle-4Nk9OO
Remotion Rendering Error: [Error [ProtocolError]: Protocol error...
POST /api/ai/render-text-overlay 500 in 16595ms
```

#### ì›ì¸

**Puppeteer/Chrome ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ í¬ë˜ì‹œ**:

1. **Base64 ë¹„ë””ì˜¤ í¬ê¸° ë¬¸ì œ**
   - 30ì´ˆ 1080x1080 ì˜ìƒ = 5-15MB
   - Base64 ì¸ì½”ë”© â†’ 33% ì¦ê°€ = 7-20MB
   - Chromeì´ ê±°ëŒ€í•œ Data URL ì²˜ë¦¬ ì‹¤íŒ¨

2. **Remotion Video ì»´í¬ë„ŒíŠ¸ ì œì•½**
   - `<Video src="data:video/mp4;base64,..." />`
   - Chromeì´ Base64ë¥¼ ë©”ëª¨ë¦¬ì— ì „ì²´ ë¡œë“œ ì‹œë„
   - ë©”ëª¨ë¦¬ ë¶€ì¡± â†’ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ (16ì´ˆ í›„ í¬ë˜ì‹œ)

3. **Vercel ì„œë²„ë¦¬ìŠ¤ ë©”ëª¨ë¦¬ ì œí•œ**
   - Chrome + Remotion + ëŒ€ìš©ëŸ‰ Base64 = ë©”ëª¨ë¦¬ ì´ˆê³¼

#### í•´ê²° ë°©ë²•

**ì„ì‹œ HTTP ì„œë²„ë¡œ íŒŒì¼ ì œê³µ**:

**ì „ëµ**:
1. Base64 â†’ ì„ì‹œ íŒŒì¼ ì €ì¥ (`os.tmpdir()`)
2. Next.js API routeë¡œ íŒŒì¼ ìŠ¤íŠ¸ë¦¬ë° ì œê³µ
3. Remotionì— HTTP URL ì „ë‹¬: `http://localhost:3000/api/temp-video/remotion_input_12345.mp4`
4. Chromeì´ HTTP ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ë¹„ë””ì˜¤ ë¡œë“œ (ë©”ëª¨ë¦¬ íš¨ìœ¨ì )

**êµ¬í˜„ ì™„ë£Œ**:
1. âœ… `src/app/api/temp-video/[id]/route.ts` (ì‹ ê·œ ìƒì„±)
   - GET ìš”ì²­ìœ¼ë¡œ ì„ì‹œ íŒŒì¼ ìŠ¤íŠ¸ë¦¬ë°
   - `Content-Type: video/mp4` í—¤ë” ì„¤ì •
   - ë³´ì•ˆ: `remotion_input_*.mp4` íŒ¨í„´ë§Œ í—ˆìš©

2. âœ… `src/app/api/ai/render-text-overlay/route.ts` (ìˆ˜ì •)
   - Base64 â†’ ì„ì‹œ íŒŒì¼ ì €ì¥
   - HTTP URL ìƒì„±í•˜ì—¬ Remotionì— ì „ë‹¬
   - ë Œë”ë§ ì™„ë£Œ í›„ ì„ì‹œ íŒŒì¼ ì‚­ì œ

**ê²°ê³¼**:
- âœ… Chrome ë©”ëª¨ë¦¬ ë¶€ë‹´ ê°ì†Œ (ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹)
- âœ… "Target closed" ì—ëŸ¬ ì™„ì „ í•´ê²°
- âœ… ì•ˆì •ì ì¸ 30ì´ˆ ì˜ìƒ ë Œë”ë§ ì„±ê³µ (15ë¶„ ì†Œìš” â†’ ëŒ€í­ ë‹¨ì¶•)

**í…ŒìŠ¤íŠ¸ ì™„ë£Œ**: ì •ìƒ ì‘ë™ í™•ì¸ âœ…

#### ìƒì„¸ ì •ë³´

ìì„¸í•œ ìˆ˜ì • ê³¼ì •ì€ [archive/error-fix-remotion-target-closed.md](./archive/error-fix-remotion-target-closed.md) ì°¸ê³ 

---

### ì˜¤ë¥˜ #16: Remotion ë Œë”ë§ ì†ë„ & ResultStep ë©”ëª¨ë¦¬ í¬ë˜ì‹œ âœ…

**ë°œìƒì¼**: 2026-01-11
**ì™„ë£Œì¼**: 2026-01-11
**íŒŒì¼**: `render-text-overlay/route.ts`, `ResultStep.tsx`
**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

#### ë¬¸ì œì 

1. **ë Œë”ë§ ì†ë„**: 15ë¶„ ì†Œìš” (Vercel 5ë¶„ ì œí•œ ì´ˆê³¼)
2. **ë¸Œë¼ìš°ì € í¬ë˜ì‹œ**: "í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ì ìš©í•˜ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ "í˜ì´ì§€ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŒ"

#### í•´ê²° ë°©ë²•

**ì„±ëŠ¥ ìµœì í™”**:
1. âœ… ë²ˆë“¤ ìºì‹± êµ¬í˜„ (ë‘ ë²ˆì§¸ ìš”ì²­ë¶€í„° 3-5ë¶„ ì ˆì•½)
2. âœ… Concurrency ìµœì í™” (4ë¡œ ê³ ì •)
3. âœ… ë¹„íŠ¸ë ˆì´íŠ¸ ê°ì†Œ (3M)
4. âœ… FPS ê°ì†Œ (24)

**ë©”ëª¨ë¦¬ í¬ë˜ì‹œ ìˆ˜ì •**:
- Base64 â†’ Blob ë³€í™˜
- JSON â†’ FormData ì „ì†¡
- multipart/form-data ì§€ì› ì¶”ê°€

**ê²°ê³¼**:
- âœ… ë Œë”ë§ ì‹œê°„ ëŒ€í­ ë‹¨ì¶•
- âœ… ë¸Œë¼ìš°ì € í¬ë˜ì‹œ ì—†ìŒ
- âœ… í˜ì´ì§€ ì•ˆì •ì„± í™•ë³´

#### ìƒì„¸ ì •ë³´

ìì„¸í•œ ìµœì í™” ê³¼ì •ì€ [archive/remotion-performance-optimization.md](./archive/remotion-performance-optimization.md) ì°¸ê³ 

---

## ìµœê·¼ í•´ê²°ëœ ì˜¤ë¥˜ (2026-01-12)

### ì˜¤ë¥˜ #17: ì˜ìƒ ë²„ë²…ì„ ë¬¸ì œ (VFR â†’ CFR ë³€í™˜) âœ…

**ë°œìƒì¼**: 2026-01-12
**ì™„ë£Œì¼**: 2026-01-12
**íŒŒì¼**: `loop-video/route.ts`
**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

#### ë¬¸ì œ ìƒí™©

**ì¦ìƒ**:
- AI ìƒì„± í™€ë¡œê·¸ë¨ ì˜ìƒì—ì„œ ì§€ì†ì ì¸ ë²„ë²…ì„(lag/stutter) ë°œìƒ
- ë£¨í”„ ì§€ì ë¿ë§Œ ì•„ë‹ˆë¼ ì „ì²´ ì˜ìƒì—ì„œ ë¯¸ì„¸í•œ ëŠê¹€ í˜„ìƒ
- 30fpsë¡œ ì„¤ì •í–ˆìŒì—ë„ í”„ë ˆì„ ë“œë/ìŠ¤í‚µ ë°œìƒ

**ê·¼ë³¸ ì›ì¸**: "Frankenstein Video" ë¬¸ì œ
1. AI ìƒì„± ë¹„ë””ì˜¤ê°€ **Variable Frame Rate (VFR)** ì‚¬ìš©
2. `loop-video/route.ts`ì—ì„œ `-c copy` ì‚¬ìš©ìœ¼ë¡œ VFR ê·¸ëŒ€ë¡œ ë³´ì¡´
3. concat ì‹œ VFR + CFR ë¹„ë””ì˜¤ í˜¼í•©ìœ¼ë¡œ íƒ€ì„ë² ì´ìŠ¤ ì¶©ëŒ
4. Remotionì´ CFR 30fpsë¥¼ ê¸°ëŒ€í•˜ì§€ë§Œ VFR ì†ŒìŠ¤ë¡œ ì¸í•œ ë Œë”ë§ ì¶©ëŒ

#### í•´ê²° ë°©ë²•: "Sanitize First" ì „ëµ

**í•µì‹¬**: AI ì›ë³¸ ë¹„ë””ì˜¤ë¥¼ ë¨¼ì € CFR 30fpsë¡œ í‘œì¤€í™”í•œ í›„ ëª¨ë“  ì²˜ë¦¬ ì§„í–‰

**ìˆ˜ì • ë‚´ìš©**:
1. **Step 0 (ì‹ ê·œ)**: ì›ë³¸ì„ CFR 30fps + GOP 30ìœ¼ë¡œ í‘œì¤€í™”
2. **Step 1 (ìˆ˜ì •)**: í‘œì¤€í™”ëœ ì†ŒìŠ¤ì—ì„œ ì—­ë°©í–¥ ìƒì„± (`trim` ì¶”ê°€ë¡œ ì¤‘ë³µ ë°©ì§€)
3. **Step 2 (ìˆ˜ì •)**: ë™ì¼ ìŠ¤í™ concat â†’ `-c copy` ì‚¬ìš© (ì¬ì¸ì½”ë”© ë¶ˆí•„ìš”)
4. **Step 3 (ìˆ˜ì •)**: ping-pong ë°˜ë³µ â†’ `-c copy` ì‚¬ìš© (ì¬ì¸ì½”ë”© ë¶ˆí•„ìš”)

**ì£¼ìš” íŒŒë¼ë¯¸í„°**:
- `-r 30`: CFR 30fps ê°•ì œ
- `-g 30`: GOP í¬ê¸° 30 (1ì´ˆë§ˆë‹¤ keyframe, Remotion seeking ìµœì í™”)
- `-sc_threshold 0`: Scene change detection ë¹„í™œì„±í™” (ì¼ê´€ëœ GOP ë³´ì¥)
- `-crf 18`: ê±°ì˜ ë¬´ì†ì‹¤ í’ˆì§ˆ

#### ê°œì„  íš¨ê³¼

| í•­ëª© | Before | After | íš¨ê³¼ |
|------|--------|-------|------|
| VFR ì²˜ë¦¬ | concat í›„ ì¬ì¸ì½”ë”© | **ë¨¼ì € CFR ë³€í™˜** | âœ… ê·¼ë³¸ í•´ê²° |
| íƒ€ì„ë² ì´ìŠ¤ | VFR+CFR í˜¼í•© | **ì™„ì „ í†µì¼** | âœ… concat ì•ˆì •ì„± |
| GOP ìµœì í™” | ì—†ìŒ | **-g 30 ì¶”ê°€** | âœ… Remotion seeking |
| ì²˜ë¦¬ ì†ë„ | ~45ì´ˆ (3ë²ˆ ì¬ì¸ì½”ë”©) | **~30ì´ˆ** (1ë²ˆë§Œ) | âœ… 15ì´ˆ ë‹¨ì¶• |
| í’ˆì§ˆ | CRF 18 (2ë²ˆ ì†ì‹¤) | **CRF 18 + copy** | âœ… ì†ì‹¤ ìµœì†Œí™” |

**ê²°ê³¼**:
- âœ… ì™„ë²½í•œ CFR 30fps ë¹„ë””ì˜¤
- âœ… ì˜ìƒ ë²„ë²…ì„ ì™„ì „ ì œê±°
- âœ… Remotion ë Œë”ë§ ìµœì í™”
- âœ… ì²˜ë¦¬ ì†ë„ 15ì´ˆ ë‹¨ì¶•

#### ìƒì„¸ ì •ë³´

ìì„¸í•œ ë¶„ì„ ë° ê¸°ìˆ  ì„¤ëª…ì€ [archive/error-fix-video-stuttering-vfr.md](./archive/error-fix-video-stuttering-vfr.md) ì°¸ê³ 

---

## ì°¸ê³  ë§í¬

### AI ì´ë¯¸ì§€ ìƒì„±
- [Google Gemini ë¬¸ì„œ](https://ai.google.dev/gemini-api/docs)

### AI ì˜ìƒ ìƒì„±
- [Higgsfield ë¬¸ì„œ](https://docs.higgsfield.ai/llms.txt)

### ì˜ìƒ ì²˜ë¦¬
- [FastPix: Video Loop](https://www.fastpix.io/blog/how-to-loop-video-playback-in-html)
- [W3Schools: Video Loop](https://www.w3schools.com/tags/att_video_loop.asp)

---

## ì•„ì¹´ì´ë¸Œ ê¸°ë¡

- [2026ë…„ 1ì›” ì•„ì¹´ì´ë¸Œ](./archive/ì˜¤ë¥˜í•´ê²°-2026-01-archived.md) - ì˜¤ë¥˜ #1~#13 (13ê±´)
- [Remotion Target Closed ì—ëŸ¬](./archive/error-fix-remotion-target-closed.md) - ì˜¤ë¥˜ #15 âœ…
- [Remotion ì„±ëŠ¥ ìµœì í™”](./archive/remotion-performance-optimization.md) - ì˜¤ë¥˜ #16 âœ…
- [ì˜ìƒ ë²„ë²…ì„ ë¬¸ì œ (VFR â†’ CFR)](./archive/error-fix-video-stuttering-vfr.md) - ì˜¤ë¥˜ #17 âœ…
- [413 Payload Too Large í•´ê²°](./archive/CORS-413-ERROR-FIX.md) - ì˜¤ë¥˜ #18, #19 âœ…
- [Vercel FFmpeg ì‘ë™ ë¬¸ì œ](./archive/FFMPEG-MERGE-BUG-ANALYSIS.md) - ì˜¤ë¥˜ #20 âœ…

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-23
